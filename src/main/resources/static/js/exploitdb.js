// AngularJS
var app = angular.module('myApp', ['infinite-scroll']);
app.controller('myCtrl', function($scope, $interval, $http) {
	var m = $scope;
	
	m.myRoleName = {};
	
	m.myRoleName['ROLE_USER'] = '用戶';
	m.myRoleName['ROLE_WRITER'] = '撰寫員';
	m.myRoleName['ROLE_REVIEWER'] = '審核員';
	m.myRoleName['ROLE_ADMIN'] = '管理員';
	
	m.myRole = [];
	m.show = false;// show translation 

	m.posts = [];
	
	angular.element(document).ready(function () {
		$http({
			method : 'GET',
			url : '/uscert/init'
		}).then(
				function successCallback(response) {
					m.myRole = response.data.roles;
				}, function errorCallback(response) {
					console.log(response);
				});
    });
	
	$http({
		method : 'GET',
		url : '/exploitdb/list'
	}).then(
			function successCallback(response) {
				response.data.forEach(function(item, index) {
					var obj = angular.fromJson(item);
					m.posts.push(obj);
				});
			}, function errorCallback(response) {

			});
	
	m.clickSave = function(item) {
		item.show = !item.show;
		console.log(item.chi);
		
		var config = {
                headers : {
                    'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;'
                }
            };
		
		var param = JSON.stringify({'postId': item._id.$oid, 'chi': item.chi});
		
		$http({
		    method: 'POST',
		    url: '/uscert/update',
		    data: param,
		    headers: {'Content-Type': 'application/json;'}
		  });
	}
	
	m.fetchCode = function(file) {
		$http.get('/exploitdb/fetchCode?file=' + m.reqFile).then(function(data) {
			console.log();
		}, null);
	}
	
	m.loadMorePost = function() {
		
		console.log('>>>');
	}	
});